# ===============================================================
# 載入套件
# ===============================================================

library(dplyr)
library(ggplot2)
library(broom)   # 整理檢定輸出

# ===============================================================
# 內建資料集：mtcars（示範單一自變數的線性模型）
# ===============================================================

data(mtcars)
mtcars2 <- as_tibble(mtcars) %>%
  mutate(am = factor(am, labels = c("automatic","manual")))

# 基本概覽與分布
summary(mtcars2$mpg)
ggplot(mtcars2, aes(mpg, fill = am)) +
  geom_histogram(bins = 12, alpha = 0.7, position = "identity") +
  labs(title = "MPG Distribution by Transmission", x = "MPG", fill = "Transmission")

# ---------------------------------------------------------------
# 線性模型觀念速記
# ---------------------------------------------------------------
# 1) t 檢定與 ANOVA 都是線性模型的特例
#    - t 檢定：比較兩組平均數
#    - ANOVA：比較多組平均數
#    - 線性模型（lm）：以迴歸方式建構 y ~ x 的關係，可同時處理類別與連續自變數
#
# 2) 模型參數解讀
#    - 截距 (Intercept)：基準組的平均值（或 x=0 時的 y 值）
#    - 類別變數係數：相對基準組的平均差異
#    - p 值：檢定該係數是否顯著不同於 0
#
# 3) 關係：
#    - t 檢定 ⇔ 單一類別變數的線性模型
#    - t 檢定統計量平方 = ANOVA 的 F 值
#    - ANOVA 是多組類別變數的線性模型特例

# ===============================================================
# 一、t 檢定（mpg ~ am）
# ===============================================================

t.test(mpg ~ am, data = mtcars2, var.equal = TRUE)

# ===============================================================
# 二、線性模型（與 t 檢定等價）
# ===============================================================

fit <- lm(mpg ~ am, data = mtcars2)
fit   # 顯示模型係數
anova(fit)  # ANOVA 表
summary(fit) # 完整模型摘要

# 驗證 t 檢定與線性模型結果相同
# t 檢定的 t 值平方應等於 ANOVA 的 F 值
t_val <- summary(fit)$coefficients[2, "t value"]
f_val <- anova(fit)$"F value"[1]
t_val^2
f_val


# ===============================================================
# 三、多變數線性模型（延伸示例）
# ===============================================================

fit2 <- lm(mpg ~ am + wt + hp, data = mtcars2)
summary(fit2)

# 這可以同時評估變速系統、車重、馬力對油耗的影響
# 解讀時需注意係數是「控制其他變數」後的邊際效應
